<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description"
        content="Mafia â€“ A real-time social deduction party game. Create a room and play with friends!" />
    <meta property="og:title" content="Mafia Game" />
    <meta property="og:description" content="Play Mafia online with friends. Real-time, no accounts needed." />
    <meta name="theme-color" content="#1e40af" />
    <title>Mafia Game ğŸ­</title>

    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/components.css" />
    <link rel="stylesheet" href="css/responsive.css" />

    <!-- Config (can be overridden per-environment by editing this block) -->
    <script>
        window.__MAFIA_CONFIG__ = {
            backendUrl: 'http://localhost:3001',
            debug: true
        };
    </script>

    <!-- Socket.IO Client (loaded from the backend server) -->
    <script src="http://localhost:3001/socket.io/socket.io.js"></script>
</head>

<body>
    <!-- â”€â”€ Toast Notifications â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="toast-container" class="toast-container" aria-live="polite"></div>

    <!-- â”€â”€ Connection Status Pill â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="connection-status" class="connection-status disconnected" role="status" aria-label="Connection status">
        <span class="status-dot"></span> Connecting...
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- SPA Container â€” only one .page.active is visible at once   -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="app-container">

        <!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— -->
        <!-- â•‘           HOME PAGE                  â•‘ -->
        <!-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <section id="page-home" class="page" role="main">
            <div class="home-hero">
                <div class="home-logo" aria-hidden="true">ğŸ­</div>
                <h1 class="home-title">MAFIA</h1>
                <p class="home-subtitle">Where lies become strategy. A real-time social deduction party game.</p>

                <div class="home-actions">
                    <button id="btn-create-room" class="btn btn-primary btn-lg" aria-label="Create new room">
                        â• Create Room
                    </button>
                    <button id="btn-join-room" class="btn btn-ghost btn-lg" aria-label="Join existing room">
                        ğŸšª Join Room
                    </button>
                </div>

                <!-- Quick rules -->
                <div class="home-rules">
                    <h2 style="font-size: var(--size-h3); margin-bottom: var(--space-md);">How to Play</h2>
                    <div class="rules-grid">
                        <div class="rule-card">
                            <div class="rule-icon">ğŸ‘¥</div>
                            <div class="rule-title">6â€“20 Players</div>
                            <div class="rule-text">Share a room code to get everyone in.</div>
                        </div>
                        <div class="rule-card">
                            <div class="rule-icon">ğŸ­</div>
                            <div class="rule-title">Secret Roles</div>
                            <div class="rule-text">Mafia, Detective, Doctor or Villager â€” only you know yours.</div>
                        </div>
                        <div class="rule-card">
                            <div class="rule-icon">ğŸŒ™</div>
                            <div class="rule-title">Night Phase</div>
                            <div class="rule-text">Mafia silently picks a target. Detective investigates. Doctor
                                protects.</div>
                        </div>
                        <div class="rule-card">
                            <div class="rule-icon">â˜€ï¸</div>
                            <div class="rule-title">Day Phase</div>
                            <div class="rule-text">Discuss, debate, and vote to eliminate a suspect.</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— -->
        <!-- â•‘         CREATE ROOM PAGE             â•‘ -->
        <!-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <section id="page-create-room" class="page" role="main">
            <div class="room-page">
                <div class="page-header">
                    <button id="create-room-back" class="page-back-btn" aria-label="Back to home">
                        â† Back
                    </button>
                    <h1>Create a Room</h1>
                    <p class="text-secondary mt-sm">Enter your name to host a game.</p>
                </div>

                <div class="card">
                    <form id="create-room-form" novalidate>
                        <div class="form-group">
                            <label class="form-label" for="create-room-name">Your Name</label>
                            <input id="create-room-name" class="form-input" type="text"
                                placeholder="Enter your player name" maxlength="20" autocomplete="nickname"
                                autocapitalize="words" required />
                            <div id="create-room-name-error" class="form-error hidden"></div>
                            <div class="form-hint">2â€“20 characters, letters and numbers only.</div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-full btn-lg">
                            ğŸ® Create Room
                        </button>
                    </form>
                </div>

                <!-- Shown after room is created -->
                <div id="create-room-result" class="card mt-lg hidden">
                    <div class="card-header">
                        <h2>ğŸ‰ Room Created!</h2>
                        <p class="text-secondary">Share this code with your friends.</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Room Code</label>
                        <div id="created-room-code" class="room-code-display">â€”â€”â€”â€”â€”â€”</div>
                    </div>

                    <button id="btn-copy-code" class="btn btn-secondary btn-full mt-md" aria-label="Copy room code">
                        ğŸ“‹ Copy Code
                    </button>

                    <!-- QR Code placeholder (Phase 2: use QRCode.js library) -->
                    <div class="qr-section mt-lg">
                        <div class="text-secondary text-sm mb-md">Or share this QR code:</div>
                        <div class="qr-placeholder" id="qr-code-container">
                            QR Code<br>(Phase 2)
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— -->
        <!-- â•‘          JOIN ROOM PAGE              â•‘ -->
        <!-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <section id="page-join-room" class="page" role="main">
            <div class="room-page">
                <div class="page-header">
                    <button id="join-room-back" class="page-back-btn" aria-label="Back to home">
                        â† Back
                    </button>
                    <h1>Join a Game</h1>
                    <p class="text-secondary mt-sm">Enter a room code to join your friends.</p>
                </div>

                <div class="card">
                    <form id="join-room-form" novalidate>
                        <div class="form-group">
                            <label class="form-label" for="join-room-code">Room Code</label>
                            <input id="join-room-code" class="form-input input-code" type="text" placeholder="ABCD1234"
                                maxlength="8" autocomplete="off" autocapitalize="characters" spellcheck="false"
                                aria-describedby="join-room-code-error" />
                            <div id="join-room-code-error" class="form-error hidden"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="join-room-name">Your Name</label>
                            <input id="join-room-name" class="form-input" type="text"
                                placeholder="Enter your player name" maxlength="20" autocomplete="nickname"
                                autocapitalize="words" aria-describedby="join-room-name-error" />
                            <div id="join-room-name-error" class="form-error hidden"></div>
                            <div class="form-hint">2â€“20 characters, letters and numbers only.</div>
                        </div>

                        <div class="btn-row">
                            <button type="submit" class="btn btn-primary btn-lg" style="flex:1">
                                ğŸšª Join Game
                            </button>
                            <button type="button" id="join-room-back-btn" class="btn btn-secondary">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— -->
        <!-- â•‘          WAITING ROOM PAGE           â•‘ -->
        <!-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <section id="page-waiting-room" class="page" role="main">
            <div class="waiting-header">
                <div>
                    <h1>Room: <span id="waiting-room-code" class="text-accent">â€”â€”</span></h1>
                    <p class="text-secondary mt-sm">Waiting for players to joinâ€¦</p>
                </div>
                <span id="waiting-player-count" class="player-count-badge">0 / 20</span>
            </div>

            <!-- Player grid -->
            <div id="waiting-player-grid" class="player-grid" role="list" aria-label="Players in room">
                <!-- Dynamically populated by main.js -->
                <div class="waiting-message">
                    <div class="spinner"></div>
                    <p>Waiting for playersâ€¦</p>
                </div>
            </div>

            <!-- Actions -->
            <div class="btn-row mt-xl">
                <!-- Start Game button (host only, shown/hidden by JS) -->
                <button id="btn-start-game" class="btn btn-primary btn-lg hidden" disabled
                    aria-label="Start game (requires 6 players)">
                    â–¶ Start Game
                </button>

                <button id="btn-leave-room" class="btn btn-secondary hidden">
                    ğŸšª Leave Room
                </button>
            </div>

            <!-- Tip for non-hosts -->
            <p id="waiting-tip" class="text-secondary text-sm mt-md text-center">
                Share the room code with friends to invite them!
            </p>
        </section>

        <!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— -->
        <!-- â•‘          ROLE REVEAL PAGE            â•‘ -->
        <!-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <section id="page-role-reveal" class="page" role="main">
            <div class="role-reveal-page">
                <div>
                    <p class="phase-label text-secondary" style="text-transform:uppercase;letter-spacing:0.12em;">
                        ğŸ­ Your Role Revealed
                    </p>
                </div>
                <div id="role-reveal-icon" class="role-icon" aria-hidden="true">ğŸ­</div>
                <div>
                    <p class="text-secondary text-sm mb-md" style="text-transform:uppercase;letter-spacing:0.08em;">You
                        are aâ€¦</p>
                    <h2 id="role-reveal-name" class="role-name">â€”</h2>
                </div>
                <p id="role-reveal-desc" class="role-desc">Loading role descriptionâ€¦</p>
                <p id="role-reveal-team" style="font-weight:700"></p>
                <p id="role-countdown" class="role-countdown text-secondary">Game starts in 3 seconds...</p>
            </div>
        </section>

        <!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— -->
        <!-- â•‘            GAME PAGE                 â•‘ -->
        <!-- Phase 2: Full night/day phase UI       â•‘ -->
        <!-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <section id="page-game" class="page" role="main">
            <!-- Phase banner -->
            <div id="game-phase-banner" class="phase-banner">
                <div id="game-phase-label" class="phase-label">ğŸ® GAME IN PROGRESS</div>
                <div id="game-phase-timer" class="phase-timer ok">â€”</div>
                <div id="game-phase-instruction" class="phase-instruction">Waiting for server...</div>
            </div>

            <!-- Death announcement (shown at start of day phase when someone died) -->
            <div id="death-announcement" class="death-announcement hidden">
                <div class="death-icon">âš°ï¸</div>
                <div id="death-msg" class="death-msg">Last night was quiet...</div>
                <div id="death-role" class="death-role"></div>
            </div>

            <!-- Players grid -->
            <h2 class="mt-lg mb-md" style="font-size:var(--size-h3)">
                Players
                <span id="alive-count"
                    style="font-size:var(--size-small);color:var(--text-secondary);font-weight:500;margin-left:8px"></span>
            </h2>
            <div id="game-player-grid" class="player-grid" role="list" aria-label="Game players">
                <!-- Populated by GameUI.renderPlayerGrid -->
            </div>

            <!-- â”€â”€â”€ Night Phase Action Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div id="night-action-panel" class="card mt-lg hidden">
                <!-- MAFIA panel -->
                <div id="panel-mafia" class="hidden">
                    <h3 style="color:var(--color-mafia);margin-bottom:var(--space-md)">ğŸ”« Choose your target</h3>
                    <p class="text-secondary text-sm mb-md">Select a villager to eliminate. Your Mafia teammates can see
                        your choice.</p>
                    <div id="mafia-target-grid" class="player-grid"></div>
                    <div class="btn-row mt-md">
                        <button id="btn-mafia-kill" class="btn btn-danger btn-lg" style="flex:1" disabled>
                            ğŸ”« Confirm Kill
                        </button>
                    </div>
                    <div id="mafia-teammate-msg" class="text-sm text-secondary mt-sm hidden"></div>
                </div>

                <!-- DETECTIVE panel -->
                <div id="panel-detective" class="hidden">
                    <h3 style="color:var(--color-primary);margin-bottom:var(--space-md)">ğŸ” Investigate a player</h3>
                    <p class="text-secondary text-sm mb-md">Select a player to learn their true role. Result delivered
                        at dawn.</p>
                    <div id="detective-target-grid" class="player-grid"></div>
                    <div class="btn-row mt-md">
                        <button id="btn-detective-check" class="btn btn-primary btn-lg" style="flex:1" disabled>
                            ğŸ” Investigate
                        </button>
                    </div>
                </div>

                <!-- DOCTOR panel -->
                <div id="panel-doctor" class="hidden">
                    <h3 style="color:var(--color-success);margin-bottom:var(--space-md)">ğŸ’Š Protect a player</h3>
                    <p class="text-secondary text-sm mb-md">Select someone to protect from the Mafia tonight (including
                        yourself).</p>
                    <div id="doctor-target-grid" class="player-grid"></div>
                    <div class="btn-row mt-md">
                        <button id="btn-doctor-save" class="btn btn-success btn-lg" style="flex:1" disabled>
                            ğŸ’Š Protect
                        </button>
                    </div>
                </div>

                <!-- VILLAGER panel (no action) -->
                <div id="panel-villager" class="hidden">
                    <div class="waiting-message">
                        <div style="font-size:48px">ğŸ˜ï¸</div>
                        <p class="text-secondary">The town sleeps... stay alert for tomorrow's discussion.</p>
                    </div>
                </div>

                <!-- Action confirmed feedback -->
                <div id="action-confirmed" class="hidden" style="text-align:center;padding:var(--space-lg)">
                    <div style="font-size:48px">âœ…</div>
                    <p id="action-confirmed-msg" style="font-weight:700;margin-top:var(--space-md)"></p>
                    <p class="text-secondary text-sm mt-sm">Waiting for other players...</p>
                </div>
            </div>

            <!-- â”€â”€â”€ Day Phase Vote UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div id="day-vote-panel" class="card mt-lg hidden">
                <h3 style="margin-bottom:var(--space-md)">ğŸ—³ï¸ Cast your vote</h3>
                <p class="text-secondary text-sm mb-md">Click a player above to select them, then confirm your vote.</p>
                <div class="btn-row">
                    <button id="btn-cast-vote" class="btn btn-danger btn-lg" style="flex:1" disabled>
                        ğŸ—³ï¸ Eliminate Selected Player
                    </button>
                </div>
                <div id="vote-confirmed" class="hidden text-secondary text-sm mt-md" style="text-align:center">
                    âœ… Vote cast! Waiting for others...
                </div>
            </div>

            <!-- â”€â”€â”€ Vote Tally â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div id="vote-tally-container" class="vote-tally mt-lg hidden">
                <!-- Populated by GameUI.renderVoteTally -->
            </div>

            <!-- â”€â”€â”€ Chat Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div id="chat-panel" class="card mt-lg hidden">
                <h3 style="margin-bottom:var(--space-md)">ğŸ’¬ Discussion</h3>
                <div id="chat-messages"
                    style="height:180px;overflow-y:auto;border:var(--border-light);border-radius:var(--radius-md);padding:var(--space-md);margin-bottom:var(--space-md);background:#f9fafb;">
                    <p id="chat-empty" class="text-secondary text-sm" style="text-align:center;padding:var(--space-md)">
                        Chat opens when voting begins...</p>
                </div>
                <div style="display:flex;gap:var(--space-sm)">
                    <input id="chat-input" class="form-input" type="text" placeholder="Say something..." maxlength="200"
                        autocomplete="off" style="flex:1" />
                    <button id="btn-send-chat" class="btn btn-primary">ğŸ“¤ Send</button>
                </div>
            </div>
        </section>

        <!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— -->
        <!-- â•‘           GAME OVER PAGE             â•‘ -->
        <!-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <section id="page-game-over" class="page" role="main">
            <div class="game-over-page">
                <div class="winner-badge" aria-hidden="true">ğŸ†</div>
                <h1 id="game-over-winner" class="winner-title">â€”</h1>

                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-box">
                        <div id="stat-rounds" class="stat-value">0</div>
                        <div class="stat-label">Rounds</div>
                    </div>
                    <div class="stat-box">
                        <div id="stat-kills" class="stat-value">0</div>
                        <div class="stat-label">Night Kills</div>
                    </div>
                    <div class="stat-box">
                        <div id="stat-eliminated" class="stat-value">0</div>
                        <div class="stat-label">Voted Out</div>
                    </div>
                </div>

                <!-- Final roles -->
                <h2 style="font-size:var(--size-h3)">Final Roles</h2>
                <table class="final-roles-table" aria-label="Final player roles">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Player</th>
                            <th>Role</th>
                            <th>Result</th>
                        </tr>
                    </thead>
                    <tbody id="final-roles-tbody">
                        <!-- Populated on game_over event -->
                    </tbody>
                </table>

                <!-- Actions -->
                <div class="btn-row mt-lg">
                    <button id="btn-play-again" class="btn btn-primary btn-lg">
                        ğŸ”„ Play Again
                    </button>
                    <button id="btn-go-home" class="btn btn-secondary btn-lg">
                        ğŸ  Go Home
                    </button>
                </div>
            </div>
        </section>

    </div><!-- .app-container -->

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- Detective Result Modal -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="detective-modal" class="modal-overlay" role="dialog" aria-modal="true"
        aria-labelledby="detective-modal-title">
        <div class="modal">
            <h2 id="detective-modal-title" class="modal-title">ğŸ” Investigation Result</h2>
            <div class="modal-body">
                <p id="detective-result-text" style="font-size:var(--size-body-lg);font-weight:600"></p>
                <p id="detective-result-detail" class="text-secondary mt-sm"></p>
            </div>
            <div class="modal-footer">
                <button id="btn-close-detective-modal" class="btn btn-primary">Got it</button>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- Scripts â€” order matters: utils â†’ socket â†’ room-mgr â†’ ui â†’ main -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script src="js/utils.js"></script>
    <script src="js/socket-client.js"></script>
    <script src="js/room-manager.js"></script>
    <script src="js/game-ui.js"></script>
    <script src="js/main.js"></script>

    <script>
        document.getElementById('join-room-back-btn')?.addEventListener('click', function () {
            document.getElementById('join-room-back')?.click();
        });
        document.getElementById('btn-close-detective-modal')?.addEventListener('click', function () {
            document.getElementById('detective-modal')?.classList.remove('active');
        });
    </script>
</body>

</html>