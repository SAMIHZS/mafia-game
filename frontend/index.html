<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description"
        content="Mafia ‚Äì A real-time social deduction party game. Create a room and play with friends!" />
    <meta property="og:title" content="Mafia Game" />
    <meta property="og:description" content="Play Mafia online with friends. Real-time, no accounts needed." />
    <meta name="theme-color" content="#1e40af" />
    <title>Mafia Game üé≠</title>

    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/components.css" />
    <link rel="stylesheet" href="css/responsive.css" />

    <!-- Config ‚Äî update backendUrl for production (Railway URL) -->
    <script>
        window.__MAFIA_CONFIG__ = {
            // üî¥ IMPORTANT BEFORE DEPLOYING:
            // Change backendUrl to your Railway production URL.
            // Example: 'https://mafia-game-production.up.railway.app'
            backendUrl: 'http://localhost:3001',
            debug: false
        };
    </script>

    <!-- QRCode.js (Phase 3) -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>

    <!-- Socket.IO & Game Scripts (Phase 3 loaded dynamically to prevent race condition) -->
    <script>
        (function () {
            var backend = window.__MAFIA_CONFIG__.backendUrl || 'http://localhost:3001';
            var s = document.createElement('script');
            s.src = backend + '/socket.io/socket.io.js';
            s.onload = function () {
                // Load game scripts only AFTER Socket.IO is ready
                var scripts = [
                    'js/utils.js',
                    'js/socket-client.js',
                    'js/room-manager.js',
                    'js/game-ui.js',
                    'js/main.js'
                ];
                scripts.forEach(function (src) {
                    var el = document.createElement('script');
                    el.src = src;
                    document.body.appendChild(el);
                });
            };
            document.head.appendChild(s);
        })();
    </script>
</head>

<body>
    <!-- ‚îÄ‚îÄ Toast Notifications ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div id="toast-container" class="toast-container" aria-live="polite"></div>

    <!-- ‚îÄ‚îÄ Connection Status Pill ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div id="connection-status" class="connection-status disconnected" role="status" aria-label="Connection status">
        <span class="status-dot"></span> Connecting...
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- SPA Container ‚Äî only one .page.active is visible at once   -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="app-container">

        <!-- ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó -->
        <!-- ‚ïë           HOME PAGE                  ‚ïë -->
        <!-- ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù -->
        <section id="page-home" class="page" role="main">
            <div class="home-hero">
                <div class="home-logo" aria-hidden="true">üé≠</div>
                <h1 class="home-title">MAFIA</h1>
                <p class="home-subtitle">Where lies become strategy. A real-time social deduction party game.</p>

                <div class="home-actions">
                    <button id="btn-create-room" class="btn btn-primary btn-lg" aria-label="Create new room">
                        ‚ûï Create Room
                    </button>
                    <button id="btn-join-room" class="btn btn-ghost btn-lg" aria-label="Join existing room">
                        üö™ Join Room
                    </button>
                </div>

                <!-- Quick rules -->
                <div class="home-rules">
                    <h2 style="font-size: var(--size-h3); margin-bottom: var(--space-md);">How to Play</h2>
                    <div class="rules-grid">
                        <div class="rule-card">
                            <div class="rule-icon">üë•</div>
                            <div class="rule-title">6‚Äì20 Players</div>
                            <div class="rule-text">Share a room code to get everyone in.</div>
                        </div>
                        <div class="rule-card">
                            <div class="rule-icon">üé≠</div>
                            <div class="rule-title">Secret Roles</div>
                            <div class="rule-text">Mafia, Detective, Doctor or Villager ‚Äî only you know yours.</div>
                        </div>
                        <div class="rule-card">
                            <div class="rule-icon">üåô</div>
                            <div class="rule-title">Night Phase</div>
                            <div class="rule-text">Mafia silently picks a target. Detective investigates. Doctor
                                protects.</div>
                        </div>
                        <div class="rule-card">
                            <div class="rule-icon">‚òÄÔ∏è</div>
                            <div class="rule-title">Day Phase</div>
                            <div class="rule-text">Discuss, debate, and vote to eliminate a suspect.</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó -->
        <!-- ‚ïë         CREATE ROOM PAGE             ‚ïë -->
        <!-- ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù -->
        <section id="page-create-room" class="page" role="main">
            <div class="room-page">
                <div class="page-header">
                    <button id="create-room-back" class="page-back-btn" aria-label="Back to home">
                        ‚Üê Back
                    </button>
                    <h1>Create a Room</h1>
                    <p class="text-secondary mt-sm">Enter your name to host a game.</p>
                </div>

                <div class="card">
                    <form id="create-room-form" novalidate>
                        <div class="form-group">
                            <label class="form-label" for="create-room-name">Your Name</label>
                            <input id="create-room-name" class="form-input" type="text"
                                placeholder="Enter your player name" maxlength="20" autocomplete="nickname"
                                autocapitalize="words" required />
                            <div id="create-room-name-error" class="form-error hidden"></div>
                            <div class="form-hint">2‚Äì20 characters, letters and numbers only.</div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-full btn-lg">
                            üéÆ Create Room
                        </button>
                    </form>
                </div>

                <!-- Shown after room is created -->
                <div id="create-room-result" class="card mt-lg hidden">
                    <div class="card-header">
                        <h2>üéâ Room Created!</h2>
                        <p class="text-secondary">Share this code with your friends.</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Room Code</label>
                        <div id="created-room-code" class="room-code-display">‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî</div>
                    </div>

                    <button id="btn-copy-code" class="btn btn-secondary btn-full mt-md" aria-label="Copy room code">
                        üìã Copy Code
                    </button>

                    <!-- QR Code (Phase 3: generated by QRCode.js) -->
                    <div class="qr-section mt-lg">
                        <div class="text-secondary text-sm mb-md">üì± Scan to join:</div>
                        <canvas id="room-qr-code" style="border-radius:var(--radius-md)"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó -->
        <!-- ‚ïë          JOIN ROOM PAGE              ‚ïë -->
        <!-- ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù -->
        <section id="page-join-room" class="page" role="main">
            <div class="room-page">
                <div class="page-header">
                    <button id="join-room-back" class="page-back-btn" aria-label="Back to home">
                        ‚Üê Back
                    </button>
                    <h1>Join a Game</h1>
                    <p class="text-secondary mt-sm">Enter a room code to join your friends.</p>
                </div>

                <div class="card">
                    <form id="join-room-form" novalidate>
                        <div class="form-group">
                            <label class="form-label" for="join-room-code">Room Code</label>
                            <input id="join-room-code" class="form-input input-code" type="text" placeholder="ABCD1234"
                                maxlength="8" autocomplete="off" autocapitalize="characters" spellcheck="false"
                                aria-describedby="join-room-code-error" />
                            <div id="join-room-code-error" class="form-error hidden"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="join-room-name">Your Name</label>
                            <input id="join-room-name" class="form-input" type="text"
                                placeholder="Enter your player name" maxlength="20" autocomplete="nickname"
                                autocapitalize="words" aria-describedby="join-room-name-error" />
                            <div id="join-room-name-error" class="form-error hidden"></div>
                            <div class="form-hint">2‚Äì20 characters, letters and numbers only.</div>
                        </div>

                        <div class="btn-row">
                            <button type="submit" class="btn btn-primary btn-lg" style="flex:1">
                                üö™ Join Game
                            </button>
                            <button type="button" id="join-room-back-btn" class="btn btn-secondary">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó -->
        <!-- ‚ïë          WAITING ROOM PAGE           ‚ïë -->
        <!-- ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù -->
        <section id="page-waiting-room" class="page" role="main">
            <div class="waiting-header">
                <div>
                    <h1>Room: <span id="waiting-room-code" class="text-accent">‚Äî‚Äî</span></h1>
                    <p class="text-secondary mt-sm">Waiting for players to join‚Ä¶</p>
                </div>
                <span id="waiting-player-count" class="player-count-badge">0 / 20</span>
            </div>

            <!-- Player grid -->
            <div id="waiting-player-grid" class="player-grid" role="list" aria-label="Players in room">
                <!-- Dynamically populated by main.js -->
                <div class="waiting-message">
                    <div class="spinner"></div>
                    <p>Waiting for players‚Ä¶</p>
                </div>
            </div>

            <!-- Actions -->
            <div class="btn-row mt-xl">
                <!-- Start Game button (host only, shown/hidden by JS) -->
                <button id="btn-start-game" class="btn btn-primary btn-lg hidden" disabled
                    aria-label="Start game (requires 6 players)">
                    ‚ñ∂ Start Game
                </button>

                <button id="btn-leave-room" class="btn btn-secondary hidden">
                    üö™ Leave Room
                </button>
            </div>

            <!-- Tip for non-hosts -->
            <p id="waiting-tip" class="text-secondary text-sm mt-md text-center">
                Share the room code with friends to invite them!
            </p>
        </section>

        <!-- ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó -->
        <!-- ‚ïë          ROLE REVEAL PAGE            ‚ïë -->
        <!-- ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù -->
        <section id="page-role-reveal" class="page" role="main">
            <div class="role-reveal-page">
                <div>
                    <p class="phase-label text-secondary" style="text-transform:uppercase;letter-spacing:0.12em;">
                        üé≠ Your Role Revealed
                    </p>
                </div>
                <div id="role-reveal-icon" class="role-icon" aria-hidden="true">üé≠</div>
                <div>
                    <p class="text-secondary text-sm mb-md" style="text-transform:uppercase;letter-spacing:0.08em;">You
                        are a‚Ä¶</p>
                    <h2 id="role-reveal-name" class="role-name">‚Äî</h2>
                </div>
                <p id="role-reveal-desc" class="role-desc">Loading role description‚Ä¶</p>
                <p id="role-reveal-team" style="font-weight:700"></p>
                <p id="role-countdown" class="role-countdown text-secondary">Game starts in 3 seconds...</p>
            </div>
        </section>

        <!-- ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó -->
        <!-- ‚ïë            GAME PAGE                 ‚ïë -->
        <!-- Phase 2: Full night/day phase UI       ‚ïë -->
        <!-- ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù -->
        <section id="page-game" class="page" role="main">
            <!-- Phase banner -->
            <div id="game-phase-banner" class="phase-banner">
                <div id="game-phase-label" class="phase-label">üéÆ GAME IN PROGRESS</div>
                <div id="game-phase-timer" class="phase-timer ok">‚Äî</div>
                <div id="game-phase-instruction" class="phase-instruction">Waiting for server...</div>
            </div>

            <!-- Death announcement (shown at start of day phase when someone died) -->
            <div id="death-announcement" class="death-announcement hidden">
                <div class="death-icon">‚ö∞Ô∏è</div>
                <div id="death-msg" class="death-msg">Last night was quiet...</div>
                <div id="death-role" class="death-role"></div>
            </div>

            <!-- Players grid -->
            <h2 class="mt-lg mb-md" style="font-size:var(--size-h3)">
                Players
                <span id="alive-count"
                    style="font-size:var(--size-small);color:var(--text-secondary);font-weight:500;margin-left:8px"></span>
            </h2>
            <div id="game-player-grid" class="player-grid" role="list" aria-label="Game players">
                <!-- Populated by GameUI.renderPlayerGrid -->
            </div>

            <!-- ‚îÄ‚îÄ‚îÄ Night Phase Action Panel ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
            <div id="night-action-panel" class="card mt-lg hidden">
                <!-- MAFIA panel -->
                <div id="panel-mafia" class="hidden">
                    <h3 style="color:var(--color-mafia);margin-bottom:var(--space-md)">üî´ Choose your target</h3>
                    <p class="text-secondary text-sm mb-md">Select a villager to eliminate. Your Mafia teammates can see
                        your choice.</p>
                    <div id="mafia-target-grid" class="player-grid"></div>
                    <div class="btn-row mt-md">
                        <button id="btn-mafia-kill" class="btn btn-danger btn-lg" style="flex:1" disabled>
                            üî´ Confirm Kill
                        </button>
                    </div>
                    <div id="mafia-teammate-msg" class="text-sm text-secondary mt-sm hidden"></div>
                </div>

                <!-- DETECTIVE panel -->
                <div id="panel-detective" class="hidden">
                    <h3 style="color:var(--color-primary);margin-bottom:var(--space-md)">üîç Investigate a player</h3>
                    <p class="text-secondary text-sm mb-md">Select a player to learn their true role. Result delivered
                        at dawn.</p>
                    <div id="detective-target-grid" class="player-grid"></div>
                    <div class="btn-row mt-md">
                        <button id="btn-detective-check" class="btn btn-primary btn-lg" style="flex:1" disabled>
                            üîç Investigate
                        </button>
                    </div>
                </div>

                <!-- DOCTOR panel -->
                <div id="panel-doctor" class="hidden">
                    <h3 style="color:var(--color-success);margin-bottom:var(--space-md)">üíä Protect a player</h3>
                    <p class="text-secondary text-sm mb-md">Select someone to protect from the Mafia tonight (including
                        yourself).</p>
                    <div id="doctor-target-grid" class="player-grid"></div>
                    <div class="btn-row mt-md">
                        <button id="btn-doctor-save" class="btn btn-success btn-lg" style="flex:1" disabled>
                            üíä Protect
                        </button>
                    </div>
                </div>

                <!-- VILLAGER panel (no action) -->
                <div id="panel-villager" class="hidden">
                    <div class="waiting-message">
                        <div style="font-size:48px">üèòÔ∏è</div>
                        <p class="text-secondary">The town sleeps... stay alert for tomorrow's discussion.</p>
                    </div>
                </div>

                <!-- Action confirmed feedback -->
                <div id="action-confirmed" class="hidden" style="text-align:center;padding:var(--space-lg)">
                    <div style="font-size:48px">‚úÖ</div>
                    <p id="action-confirmed-msg" style="font-weight:700;margin-top:var(--space-md)"></p>
                    <p class="text-secondary text-sm mt-sm">Waiting for other players...</p>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ‚îÄ Day Phase Vote UI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
            <div id="day-vote-panel" class="card mt-lg hidden">
                <h3 style="margin-bottom:var(--space-md)">üó≥Ô∏è Cast your vote</h3>
                <p class="text-secondary text-sm mb-md">Click a player above to select them, then confirm your vote.</p>
                <div class="btn-row">
                    <button id="btn-cast-vote" class="btn btn-danger btn-lg" style="flex:1" disabled>
                        üó≥Ô∏è Eliminate Selected Player
                    </button>
                </div>
                <div id="vote-confirmed" class="hidden text-secondary text-sm mt-md" style="text-align:center">
                    ‚úÖ Vote cast! Waiting for others...
                </div>
            </div>

            <!-- ‚îÄ‚îÄ‚îÄ Vote Tally ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
            <div id="vote-tally-container" class="vote-tally mt-lg hidden">
                <!-- Populated by GameUI.renderVoteTally -->
            </div>

            <!-- ‚îÄ‚îÄ‚îÄ Chat Panel ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
            <div id="chat-panel" class="card mt-lg hidden">
                <h3 style="margin-bottom:var(--space-md)">üí¨ Discussion</h3>
                <div id="chat-messages"
                    style="height:180px;overflow-y:auto;border:var(--border-light);border-radius:var(--radius-md);padding:var(--space-md);margin-bottom:var(--space-md);background:#f9fafb;">
                    <p id="chat-empty" class="text-secondary text-sm" style="text-align:center;padding:var(--space-md)">
                        Chat opens when voting begins...</p>
                </div>
                <div style="display:flex;gap:var(--space-sm)">
                    <input id="chat-input" class="form-input" type="text" placeholder="Say something..." maxlength="200"
                        autocomplete="off" style="flex:1" />
                    <button id="btn-send-chat" class="btn btn-primary">üì§ Send</button>
                </div>
            </div>
        </section>

        <!-- ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó -->
        <!-- ‚ïë           GAME OVER PAGE             ‚ïë -->
        <!-- ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù -->
        <section id="page-game-over" class="page" role="main">
            <div class="game-over-page">
                <div class="winner-badge" aria-hidden="true">üèÜ</div>
                <h1 id="game-over-winner" class="winner-title">‚Äî</h1>

                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-box">
                        <div id="stat-rounds" class="stat-value">0</div>
                        <div class="stat-label">Rounds</div>
                    </div>
                    <div class="stat-box">
                        <div id="stat-kills" class="stat-value">0</div>
                        <div class="stat-label">Night Kills</div>
                    </div>
                    <div class="stat-box">
                        <div id="stat-eliminated" class="stat-value">0</div>
                        <div class="stat-label">Voted Out</div>
                    </div>
                </div>

                <!-- Final roles -->
                <h2 style="font-size:var(--size-h3)">Final Roles</h2>
                <table class="final-roles-table" aria-label="Final player roles">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Player</th>
                            <th>Role</th>
                            <th>Result</th>
                        </tr>
                    </thead>
                    <tbody id="final-roles-tbody">
                        <!-- Populated on game_over event -->
                    </tbody>
                </table>

                <!-- Actions -->
                <div class="btn-row mt-lg">
                    <button id="btn-play-again" class="btn btn-primary btn-lg">
                        üîÑ Play Again
                    </button>
                    <button id="btn-go-home" class="btn btn-secondary btn-lg">
                        üè† Go Home
                    </button>
                </div>
            </div>
        </section>

    </div><!-- .app-container -->

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- Detective Result Modal -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="detective-modal" class="modal-overlay" role="dialog" aria-modal="true"
        aria-labelledby="detective-modal-title">
        <div class="modal">
            <h2 id="detective-modal-title" class="modal-title">üîç Investigation Result</h2>
            <div class="modal-body">
                <p id="detective-result-text" style="font-size:var(--size-body-lg);font-weight:600"></p>
                <p id="detective-result-detail" class="text-secondary mt-sm"></p>
            </div>
            <div class="modal-footer">
                <button id="btn-close-detective-modal" class="btn btn-primary">Got it</button>
            </div>
        </div>
    </div>

    <!-- Note: Game scripts are loaded dynamically in the <head> s.onload callback -->
    <script>
        // Setup simple inline event listeners
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('join-room-back-btn')?.addEventListener('click', function () {
                document.getElementById('join-room-back')?.click();
            });
            document.getElementById('btn-close-detective-modal')?.addEventListener('click', function () {
                document.getElementById('detective-modal')?.classList.remove('active');
            });
        });

        // QR Code generation (Phase 3)
        // Called from main.js after room creation: window.generateRoomQR(roomCode)
        window.generateRoomQR = function (roomCode) {
            var canvas = document.getElementById('room-qr-code');
            if (!canvas || typeof QRCode === 'undefined') return;
            var joinUrl = window.location.origin + '/?code=' + roomCode;
            QRCode.toCanvas(canvas, joinUrl, { width: 180, margin: 1, color: { dark: '#1e40af' } }, function (err) {
                if (err) console.warn('QR generation error:', err);
            });
        };
    </script>
</body>

</html>